<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <script type="text/javascript">
    function test(resovle, reject) {
        var timeout = Math.random() * 2;
        console.log('settimeout' + timeout);
        setTimeout(function() {
            if (timeout < 1) {
                console.log('call resolve()');
                resovle('200 OK');
            } else {
                console.log("call reject()");
                reject('reject');
            }
        }, timeout * 1000);
    }
    // var p1 = new Promise(test);
    // var p2 = p1.then(function(r) {
    //     console.log(r);
    //     console.log('正确')
    // }).catch(function(r) {
    //     console.log(r)
    // })


    function getTree(input) {
    	return new Promise(function(resolve,reject){
        var timeout = Math.random() * 2;
        console.log(timeout)
        setTimeout(function(){
        	if (timeout < 1) {
            console.log("获取到tree了");
            resolve('用await获取tree');
        } else {
            console.log("没获取到tree");
            reject();
        }},timeout * 1000)
        })
    }

    function getData(input) {
        return new Promise(function(resolve, reject) {
            var timeout = Math.random() * 2;
            console.log(timeout)
            if (timeout < 1) {
                console.log("获取到data了");
                resolve('用await获取data');
            } else {
                console.log("没获取到data");
                reject();
            }
        })
    }


    // var p = new Promise(function(resolve,reject){
    // 	console.log("哈哈开始了")
    // 	resolve('哈哈开始了')
    // });
    // p.then(getTree).then(getData).catch(function(r){

    // })
    // Promise.all([getTree(),getData()]).then(function(r){
    // 	console.log(r)
    // 	console.log("都获得了")
    // }).catch(function(r){
    // 	console.log(r)
    // 	console.log("有一个不对")
    // })

    async function getall(){
    	try{
    	let tree=await getTree()
    	let data=await getData()  
    	//以下代码相当于then

    	console.log(tree,data,"都获取到了")}
    	catch(e){
    		console.log(e)
    	}
    }

    console.log(getall())

    console.log("我在异步之前")

    </script>
</head>

<body>
</body>

</html>