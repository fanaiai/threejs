<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <style type="text/css">
    #three {
        width: 800px;
        height: 500px;
    }
    </style>
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="three.js"></script>
    <script type="text/javascript" src="stats.min.js"></script>
</head>

<body>
    <div id="three"></div>
    <div id="Stats-output"></div>
</body>
<script type="text/javascript">
var scene;
var stats = initStats();

function initStats() {
    var stats = new Stats();
    //设置统计模式
    stats.setMode(0); // 0: fps, 1: ms
    //统计信息显示在左上角
    stats.domElement.style.position = 'absolute';
    stats.domElement.style.left = '0px';
    stats.domElement.style.top = '0px';
    //将统计对象添加到对应的<div>元素中
    document.getElementById("Stats-output").appendChild(stats.domElement);
    return stats;
}

function initScene() {
    scene = new THREE.Scene();
}

var camera;

function initCamera() {
    camera = new THREE.PerspectiveCamera(75, $("#three").width() / $("#three").height(), 0.1, 1000);
    camera.position.z = 15;
}
// var cube;
// function initObj(){
//  var geometry = new THREE.BoxGeometry( 1, 1, 1 );
//  var material = new THREE.MeshLambertMaterial( { color: 0x00ff00 } );
//  cube = new THREE.Mesh( geometry, material );
//  scene.add( cube );
// }
var earchcircle;
function addearchcircle() {
    var geometry = new THREE.CircleBufferGeometry(5.4, 32);
    var material = new THREE.MeshBasicMaterial({ color:0xffffff });
    earchcircle = new THREE.Mesh(geometry, material);
    earchcircle.rotation.z = Math.PI / 4;
}

var sphere;
var geometry;
function addBall() {
    var texture = new THREE.TextureLoader().load('earth.jpg', function(texture) {
        renderer.render(scene, camera);
    });
    geometry = new THREE.SphereGeometry(5, 32, 32);
    var material = new THREE.MeshLambertMaterial({ map: texture, transparent: true });
    sphere = new THREE.Mesh(geometry, material);
    sphere.rotation.z = Math.PI / 4;
    scene.add(sphere);
}

var items = [];
var imgpaths=['wb.png','bd.png','wx.png','2.png','3.png']

function addItem(imgpath) {
    var texture = new THREE.TextureLoader().load(imgpath, function(texture) {
        var width = texture.image.width;
        var height = texture.image.height;
        var w=Math.random() + 1;
        var h=w*height/width;
        var geometry = new THREE.PlaneBufferGeometry(w,h, 1);
        var material = new THREE.MeshBasicMaterial({ map: texture, transparent: true });
        var item = new THREE.Mesh(geometry, material);
        item.position.x = Math.random()*30-15;
        item.position.y = Math.random()*30-15;
        item.position.z = Math.random()*10-5;
        scene.add(item);
        items.push(item);
    });
}

function addItems(){
    addItem('wb.png')
    addItem('bd.png')
}

var renderer;

function initRenderer() {
    renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize($("#three").width(), $("#three").height());
    renderer.setClearColor(new THREE.Color('rgb(71, 75, 159)'));
    $("#three").append(renderer.domElement);
}

var light;

function initLight() {
    light = new THREE.DirectionalLight(0xffffff);
    light.position.set(0, 0, 4);
    scene.add(light);
}



function initAll() {
    initScene();
    initCamera();
    initRenderer();
    addBall();
    addItems();
    addearchcircle();
    
    initLight();
    renderer.render(scene, camera)
}
initAll();
var up = true;

function animate() {
    requestAnimationFrame(animate);
    stats.update();
    // if(sphere.scale.y>1.5){
    //     up=false;
    // }
    // if(sphere.scale.y<1){
    //     up=true;
    // }
    // if(up){
    //     sphere.scale.y+=0.005;
    //     sphere.scale.x+=0.005;
    // }
    // else{
    //     sphere.scale.y-=0.005;
    //     sphere.scale.x-=0.005;
    // }
    // 
    sphere.rotation.y += 0.01;
            // sphere.scale.x=1;
            // sphere.scale.y=1;
            // sphere.scale.z=1;
    for(var i=0;i<items.length;i++){
        if(items[i].position.x>0){
            items[i].position.x-=0.1;
        }
        else{
            items[i].position.x+=0.1;
        }
        if(items[i].position.y>0){
            items[i].position.y-=0.1;
        }
        else{
            items[i].position.y+=0.1;
        }
        if(items[i].position.z>1){
            items[i].position.z-=0.1;
        }
        else{
            items[i].position.z+=0.1;
        }
        // scene.remove(earchcircle)
        if(Math.abs(items[i].position.x)<=5/3 || Math.abs(items[i].position.y)<=5/3){
            
            scene.remove(items[i])
            items.splice(i,1);
            addItem(imgpaths[Math.round(Math.random()*4)]);
            // scene.add(earchcircle)
            
        }
    }
    // sphere.rotation.y+=0.01;
    renderer.render(scene, camera);
}
animate();
</script>

</html>