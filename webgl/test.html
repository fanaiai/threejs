<!DOCTYPE html>
<html>

<head>
    <title></title>
    <meta charset="utf-8">
    <script type="text/javascript" src="utils/webgl-utils.js"></script>
    <script type="text/javascript" src="../jquery.min.js"></script>
    <script type="text/javascript" src="utils/webgl-lessons-ui.js"></script>
    <style type="text/css">
    body {
        background: #eee;
    }

    body>div {
        text-align: center;
        position: relative;
        margin-top: 70px;
    }

    canvas {
        width: 600px;
        height: 400px;
        border: 1px solid #ccc;
        background: #fff;
        margin: 0 auto;
    }

    #ui {
        position: absolute;
        top: 0;
        left: 80%;
        width: 250px;
    }
    .gman-widget-outer>div,.gman-widget-outer>input{
      display: inline-block;
    }
    </style>
</head>

<body>
    <div>
        <canvas id="c">
        </canvas>
        <div id="uiContainer">
            <div id="ui">
                <div id="x"></div>
                <div id="y"></div>
                <div id="angle"></div>
                <div id="scaleX"></div>
                <div id="scaleY"></div>
            </div>
        </div>
    </div>
    <script id="vertex-shader" type="x-shader/x-vertex">
    attribute vec2 a_position;
    uniform vec2 u_resolution;
    uniform mat3 u_matrix;

    void main() {
        vec2 position=(u_matrix*vec3(a_position,1)).xy;
        vec2 zeroToOne=position/u_resolution;
        vec2 zeroToTwo=zeroToOne*2.0;
        vec2 clipSpace=zeroToTwo-1.0;

        gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
    }
    </script>
    <script id="fragment-shader" type="x-shader/x-fragment">
      precision mediump float;

      uniform vec4 u_color;

      void main() {
         gl_FragColor = u_color;
      }
    </script>
</body>
<script>
function main(){
   var canvas=document.getElementById("c");
   var gl=canvas.getContext("webgl");
   if(!gl){
      return;
   }
   gl.enable(gl.DEPTH_TEST);

   var arrays={
          position: { numComponents: 3, data: [0, 0, 0, 10, 0, 0, 0, 10, 0, 10, 10, 0], },
     texcoord: { numComponents: 2, data: [0, 0, 0, 1, 1, 0, 1, 1],                 },
     normal:   { numComponents: 3, data: [0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1],     },
     indices:  { numComponents: 3, data: [0, 1, 2, 1, 2, 3],                       },
   }

   var bufferInfo=webglUtils.createBufferInfoFromArrays(gl,arrays);

   var program=webglUtils.createProgramFromScripts(gl,['vertex-shader','fragment-shader']);
   var uniformSetters=webglUtils.createUniformSetters(gl,program);
   var attribSetters=webglUtils.createAttributeSetters(gl,program);
   function degToRad(d){
      return d*Math.PI/180;
   }

   var cameraAngleRadians=degToRag(0);
   var fieldOfViewRadians=degToRag(60);

   var cameraHeight=50;

   var uniformsThatAreTheSameForAllObjects={
     u_lightWorldPos:         [-50, 30, 100],
    u_viewInverse:           m4.identity(),
    u_lightColor:            [1, 1, 1, 1],     
 };
   var uniformsThatAreComputedForEachObject={
    u_worldViewProjection:   m4.identity(),
    u_world:                 m4.identity(),
    u_worldInverseTranspose: m4.identity(),      
 };

 var rand=function(min,max){
   if(max===undefined){
      max=min;
      min=0;
   }
   return min+Math.random()*(max-min);
 };

 var randInt=function(range){
   return Math.floor(Math.random()*range);
 };

 var textures=[
     textureUtils.makeStripeTexture(gl, { color1: "#FFF", color2: "#CCC", }),
    textureUtils.makeCheckerTexture(gl, { color1: "#FFF", color2: "#CCC", }),
    textureUtils.makeCircleTexture(gl, { color1: "#FFF", color2: "#CCC", }),
    ];

   var objects=[];

   var numObjects=300;
   var baseColor=rand(240);
   for(var ii=0;ii<numObjects;++ii){
      objects.push({
         radiu:rand(150),
         xRotation:rand(Math.PI*2),
         yRotation:rand(Math.PI),
         materailUniforms:{
        u_colorMult:             chroma.hsv(rand(baseColor, baseColor + 120), 0.5, 1).gl(),
        u_diffuse:               textures[randInt(textures.length)],
        u_specular:              [1, 1, 1, 1],
        u_shininess:             rand(500),
        u_specularFactor:        rand(1),            
     },
      });
   }
   requestAnimationFrame(drawScene);

   function drawScene(time){
      time=time*0.0001+5;
      webglUtils.resizeCanvasToDisplaySize(gl.canvas);
      
   }

}
</script>

</html>